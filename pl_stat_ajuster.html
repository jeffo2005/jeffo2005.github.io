<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier League Stat Adjuster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate Gray & Amber -->
    <!-- Application Structure Plan: A single-page dashboard design. The structure flows from broad context to specific interaction: 1. A clear textual explanation of the methodology. 2. A visual comparison of league difficulty factors (bar charts) to build user trust and understanding. 3. An interactive calculator for users to apply the methodology to their own data points. 4. A Gemini API-powered section that automatically generates a player scouting report using the adjusted stats from the calculator and comparing them to the raw stats. This single-button workflow makes the process seamless and intuitive, guiding the user to a full, integrated analysis with a single action. -->
    <!-- Visualization & Content Choices: Report Info: League difficulty factors (UEFA coeff, competitiveness), player stats, and scouting reports. Goal: Compare leagues, allow stat adjustment, and generate qualitative player analysis. Viz/Presentation: Bar charts (Chart.js) for league comparison, a form with dropdowns and an input field for stat entry, and a dynamic text block for output. The AI report is now dynamically updated based on the calculator's output. Interaction: User selects a league and stat type, inputs a value, and clicks a single button to get both the adjusted number and the AI report, which now includes a direct comparison to the raw stat. This creates a powerful, integrated user flow. Justification: Bar charts are excellent for direct comparison. The calculator and LLM-powered report provide clear, task-oriented user interactions, directly serving the user's goal. Library/Method: Chart.js for canvas-based charts, Vanilla JS for all logic and the Gemini API call. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        .stat-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .result-card {
             background: linear-gradient(135deg, #1e3a8a, #3b82f6);
             color: white;
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold leading-tight text-slate-900">Premier League Stat Adjuster</h1>
            <p class="mt-1 text-slate-500">Quantifying the "PL Tax": Translating player performance across Europe's top leagues.</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">

            <div class="lg:col-span-3 space-y-8">
                <div class="stat-card">
                    <h2 class="text-xl font-semibold text-slate-900 mb-3">The Methodology Explained</h2>
                    <p class="text-slate-600">
                        This tool adjusts player statistics from Europe's other top leagues (La Liga, Serie A, Bundesliga, Ligue 1) to estimate their performance if they played in the Premier League. Not all leagues are equal in difficulty, and this model attempts to quantify that difference. The adjustment is based on a "League Difficulty Score" (LDS), calculated from two key factors:
                    </p>
                    <ul class="list-disc list-inside mt-4 space-y-2 text-slate-600">
                        <li><span class="font-semibold">UEFA Coefficient (70% weight):</span> An objective measure of how well a league's clubs perform in European competitions against clubs from other top leagues.</li>
                        <li><span class="font-semibold">Intra-League Competitiveness (30% weight):</span> A proxy for domestic difficulty, measured by the average points gap between the top and bottom teams. A smaller gap suggests a more competitive and challenging league from top to bottom.</li>
                    </ul>
                     <p class="text-slate-600 mt-4">
                        The final "Adjustment Factor" for each league reflects its difficulty relative to the Premier League. A factor below 1.0 means stats are scaled down, while a factor above 1.0 would mean they are scaled up.
                    </p>
                </div>
            </div>

            <div class="lg:col-span-3 stat-card">
                 <h2 class="text-xl font-semibold text-slate-900 mb-4 text-center">League Difficulty Comparison</h2>
                 <p class="text-slate-600 text-center mb-6">These charts show the raw factors and the final calculated adjustment multiplier for each league relative to the Premier League.</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-medium text-center mb-2">Normalized Difficulty Factors</h3>
                        <div class="chart-container">
                            <canvas id="factorsChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-center mb-2">Final Adjustment Factor (vs PL)</h3>
                        <div class="chart-container">
                             <canvas id="adjustmentChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3 stat-card">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">Stat Adjustment Calculator</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                    <div class="space-y-4">
                         <div>
                            <label for="playerName" class="block text-sm font-medium text-slate-700">Player Name</label>
                            <input type="text" name="playerName" id="playerName" placeholder="e.g., Victor Osimhen" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md">
                        </div>
                        <div>
                            <label for="league" class="block text-sm font-medium text-slate-700">Original League</label>
                            <select id="league" name="league" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                             <div>
                                <label for="plYear" class="block text-sm font-medium text-slate-700">PL Year</label>
                                <select id="plYear" name="plYear" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                    <option value="2023" selected>2023</option>
                                    <option value="2022">2022</option>
                                </select>
                            </div>
                            <div>
                                <label for="rawStatYear" class="block text-sm font-medium text-slate-700">Raw Stat Year</label>
                                <select id="rawStatYear" name="rawStatYear" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                    <option value="2025">2025</option>
                                    <option value="2024">2024</option>
                                    <option value="2023" selected>2023</option>
                                    <option value="2022">2022</option>
                                </select>
                            </div>
                        </div>
                         <div class="space-y-4">
                            <h3 class="text-md font-semibold text-slate-900">Model Customization</h3>
                            <p class="text-sm text-slate-500">Adjust the weight of each factor in the League Multiplier calculation.</p>
                            <div>
                                <label for="uefaWeight" class="block text-sm font-medium text-slate-700">UEFA Weighting: <span id="uefaWeightValue">70%</span></label>
                                <input type="range" id="uefaWeight" name="uefaWeight" min="0" max="100" value="70" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <label for="compWeight" class="block text-sm font-medium text-slate-700">Competitiveness Weighting: <span id="compWeightValue">30%</span></label>
                                <input type="range" id="compWeight" name="compWeight" min="0" max="100" value="30" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>
                        <div>
                            <label for="statType" class="block text-sm font-medium text-slate-700">Stat Type</label>
                            <select id="statType" name="statType" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                            </select>
                        </div>
                         <div>
                            <label for="statValue" class="block text-sm font-medium text-slate-700">Raw Stat Value</label>
                            <input type="number" name="statValue" id="statValue" step="0.01" value="0.50" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md">
                        </div>
                        <div class="space-y-2 p-4 bg-slate-50 rounded-md">
                            <h3 class="text-sm font-semibold text-slate-900">Playstyle Multiplier (PM) Inputs</h3>
                            <p class="text-xs text-slate-500">Input raw stats to calculate the player's stylistic fit for the PL.</p>
                            <div>
                                <label for="tacklesValue" class="block text-sm font-medium text-slate-700">Tackles per 90</label>
                                <input type="number" name="tacklesValue" id="tacklesValue" step="0.01" value="2.5" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md">
                            </div>
                            <div>
                                <label for="dribblesValue" class="block text-sm font-medium text-slate-700">Dribbles per 90</label>
                                <input type="number" name="dribblesValue" id="dribblesValue" step="0.01" value="3.0" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md">
                            </div>
                            <div>
                                <label for="progPassesValue" class="block text-sm font-medium text-slate-700">Progressive Passes per 90</label>
                                <input type="number" name="progPassesValue" id="progPassesValue" step="0.01" value="8.0" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md">
                            </div>
                        </div>
                        <button id="calculateBtn" class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            Adjust and Analyze
                        </button>
                    </div>

                    <div id="result" class="result-card p-6 text-center flex flex-col justify-center items-center h-full min-h-[150px]">
                        <p class="text-lg font-medium text-blue-200">Adjusted Performance</p>
                        <p id="adjustedValue" class="text-4xl font-bold tracking-tight text-white">-</p>
                        <p id="equivalentText" class="text-blue-200">Select a stat to get its PL equivalent.</p>
                        <div class="mt-4 text-left w-full space-y-1">
                            <p class="text-sm">LM: <span id="lmValue" class="font-bold text-amber-200">N/A</span></p>
                            <p class="text-sm">PM: <span id="pmValue" class="font-bold text-amber-200">N/A</span></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="lg:col-span-3 stat-card">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">✨ AI Scout Report ✨</h2>
                <div class="grid grid-cols-1 gap-6 items-start">
                    <div class="stat-card min-h-[200px] flex items-center justify-center p-6 bg-slate-50">
                        <div id="reportContainer" class="w-full space-y-4">
                            <p id="analysisText" class="text-center text-slate-500 italic">Enter a player and stats above to generate a scouting report with adjusted numbers.</p>
                        </div>
                    </div>
                     <div id="followUpSection" class="hidden">
                        <div id="chatHistory" class="space-y-4 p-4 rounded-md bg-white border border-slate-200 h-64 overflow-y-auto mb-4"></div>
                        <div class="flex space-x-2">
                             <textarea id="followUpInput" class="flex-1 resize-none border border-slate-300 rounded-md p-2 text-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Ask a follow-up question..."></textarea>
                            <button id="followUpBtn" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3 stat-card">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">Player Comparison Chart</h2>
                 <p class="text-slate-600 mb-4 text-center">This chart compares your player's raw stat to the top 5 players in the Premier League for that same stat in the selected year.</p>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>

        </div>
    </main>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const leagueData = {
            'Premier League': {
                '2025': { uefaCoeff: 106.5, competitiveness: 0.020, color: 'rgba(59, 130, 246, 0.7)' },
                '2024': { uefaCoeff: 104.3, competitiveness: 0.020, color: 'rgba(59, 130, 246, 0.7)' },
                '2023': { uefaCoeff: 98.2, competitiveness: 0.021, color: 'rgba(59, 130, 246, 0.7)' },
                '2022': { uefaCoeff: 94.6, competitiveness: 0.022, color: 'rgba(59, 130, 246, 0.7)' },
            },
            'Serie A': {
                '2025': { uefaCoeff: 92.5, competitiveness: 0.017, color: 'rgba(16, 185, 129, 0.7)' },
                '2024': { uefaCoeff: 89.9, competitiveness: 0.017, color: 'rgba(16, 185, 129, 0.7)' },
                '2023': { uefaCoeff: 85.3, competitiveness: 0.016, color: 'rgba(16, 185, 129, 0.7)' },
                '2022': { uefaCoeff: 81.1, competitiveness: 0.015, color: 'rgba(16, 185, 129, 0.7)' },
            },
            'La Liga': {
                '2025': { uefaCoeff: 90.8, competitiveness: 0.018, color: 'rgba(239, 68, 68, 0.7)' },
                '2024': { uefaCoeff: 89.4, competitiveness: 0.018, color: 'rgba(239, 68, 68, 0.7)' },
                '2023': { uefaCoeff: 88.9, competitiveness: 0.017, color: 'rgba(239, 68, 68, 0.7)' },
                '2022': { uefaCoeff: 84.7, competitiveness: 0.018, color: 'rgba(239, 68, 68, 0.7)' },
            },
            'Bundesliga': {
                '2025': { uefaCoeff: 87.7, competitiveness: 0.016, color: 'rgba(245, 158, 11, 0.7)' },
                '2024': { uefaCoeff: 86.6, competitiveness: 0.016, color: 'rgba(245, 158, 11, 0.7)' },
                '2023': { uefaCoeff: 83.3, competitiveness: 0.015, color: 'rgba(245, 158, 11, 0.7)' },
                '2022': { uefaCoeff: 80.1, competitiveness: 0.016, color: 'rgba(245, 158, 11, 0.7)' },
            },
            'Ligue 1': {
                '2025': { uefaCoeff: 68.2, competitiveness: 0.015, color: 'rgba(139, 92, 246, 0.7)' },
                '2024': { uefaCoeff: 66.8, competitiveness: 0.015, color: 'rgba(139, 92, 246, 0.7)' },
                '2023': { uefaCoeff: 62.4, competitiveness: 0.014, color: 'rgba(139, 92, 246, 0.7)' },
                '2022': { uefaCoeff: 58.7, competitiveness: 0.015, color: 'rgba(139, 92, 246, 0.7)' },
            },
        };
        const topPLPlayersData = {
            '2025': {
                'Goals per 90': {
                    'Erling Haaland': 0.95, 'Darwin Nunez': 0.85, 'Cole Palmer': 0.82, 'Ollie Watkins': 0.75, 'Alexander Isak': 0.72
                },
                'xG per 90': {
                    'Erling Haaland': 0.91, 'Darwin Nunez': 0.88, 'Cole Palmer': 0.80, 'Alexander Isak': 0.75, 'Ollie Watkins': 0.73
                },
                'Assists per 90': {
                    'Kevin De Bruyne': 0.55, 'Bruno Fernandes': 0.51, 'Cole Palmer': 0.48, 'Leandro Trossard': 0.45, 'Martin Ødegaard': 0.44
                },
                'Progressive Passes per 90': {
                    'Rodri': 9.8, 'Kevin De Bruyne': 9.5, 'Bruno Guimarães': 9.1, 'Trent Alexander-Arnold': 8.9, 'Pascal Groß': 8.7
                },
                'Dribbles per 90': {
                    'Eberechi Eze': 4.0, 'Jérémy Doku': 3.9, 'Michael Olise': 3.6, 'Cole Palmer': 3.4, 'Bukayo Saka': 3.3
                },
                'Tackles per 90': {
                    'João Palhinha': 4.1, 'Bruno Guimarães': 3.9, 'Declan Rice': 3.8, 'Alexis Mac Allister': 3.6, 'Yves Bissouma': 3.5
                },
                'Interceptions per 90': {
                    'João Palhinha': 2.6, 'Rodri': 2.4, 'William Saliba': 2.2, 'Virgil van Dijk': 2.1, 'Malo Gusto': 2.0
                },
                'Aerials Won per 90': {
                    'James Tarkowski': 5.2, 'Dan Burn': 5.0, 'Harry Maguire': 4.9, 'Ivan Toney': 4.7, 'Ollie Watkins': 4.6
                },
                'Shot-Creating Actions (SCA) per 90': {
                    'Kevin De Bruyne': 6.8, 'Bruno Fernandes': 6.1, 'Phil Foden': 5.8, 'Cole Palmer': 5.5, 'Bukayo Saka': 5.4
                },
                'Goal-Creating Actions (GCA) per 90': {
                    'Kevin De Bruyne': 1.3, 'Bruno Fernandes': 1.2, 'Leandro Trossard': 1.1, 'Mohamed Salah': 1.05, 'Bukayo Saka': 1.02
                },
                'Carries into Final Third per 90': {
                    'Jérémy Doku': 7.8, 'Jack Grealish': 7.2, 'Michael Olise': 7.0, 'Bukayo Saka': 6.8, 'Phil Foden': 6.5
                },
                'Progressive Carries per 90': {
                    'Jérémy Doku': 13.8, 'Jack Grealish': 13.2, 'Eberechi Eze': 13.0, 'Mohamed Salah': 12.8, 'Phil Foden': 12.5
                },
                'Pass Completion %': {
                    'Manuel Akanji': 94.2, 'Rodri': 93.8, 'John Stones': 93.2, 'William Saliba': 93.0, 'Nathan Aké': 92.8
                },
                'Shots on Target %': {
                    'Cole Palmer': 59.0, 'Erling Haaland': 56.0, 'Harry Kane': 53.0, 'Ollie Watkins': 51.0, 'Dominic Solanke': 49.0
                }
            },
            '2024': {
                'Goals per 90': {
                    'Cole Palmer': 0.85, 'Ollie Watkins': 0.70, 'Dominic Solanke': 0.65, 'Phil Foden': 0.60, 'Alexander Isak': 0.59
                },
                'xG per 90': {
                    'Cole Palmer': 0.78, 'Ollie Watkins': 0.68, 'Dominic Solanke': 0.62, 'Alexander Isak': 0.58, 'Darwin Núñez': 0.55
                },
                'Assists per 90': {
                    'Cole Palmer': 0.45, 'Martin Ødegaard': 0.42, 'Leandro Trossard': 0.40, 'Bruno Fernandes': 0.39, 'Morgan Gibbs-White': 0.37
                },
                'Progressive Passes per 90': {
                    'Rodri': 9.5, 'Kevin De Bruyne': 9.1, 'Bruno Guimarães': 8.8, 'Pascal Groß': 8.6, 'Trent Alexander-Arnold': 8.5
                },
                'Dribbles per 90': {
                    'Eberechi Eze': 3.8, 'Jérémy Doku': 3.6, 'Solly March': 3.3, 'Cole Palmer': 3.2, 'Michael Olise': 3.1
                },
                'Tackles per 90': {
                    'João Palhinha': 3.9, 'Yves Bissouma': 3.7, 'Declan Rice': 3.5, 'Alexis Mac Allister': 3.3, 'Bruno Guimarães': 3.2
                },
                'Interceptions per 90': {
                    'João Palhinha': 2.5, 'Rodri': 2.3, 'Malo Gusto': 2.1, 'William Saliba': 2.0, 'Virgil van Dijk': 1.9
                },
                'Aerials Won per 90': {
                    'Dan Burn': 5.0, 'James Tarkowski': 4.8, 'Harry Maguire': 4.6, 'Ivan Toney': 4.4, 'Ollie Watkins': 4.3
                },
                'Shot-Creating Actions (SCA) per 90': {
                    'Kevin De Bruyne': 6.5, 'Bruno Fernandes': 5.8, 'Phil Foden': 5.5, 'Cole Palmer': 5.2, 'Bukayo Saka': 5.1
                },
                'Goal-Creating Actions (GCA) per 90': {
                    'Kevin De Bruyne': 1.2, 'Bruno Fernandes': 1.1, 'Leandro Trossard': 1.05, 'Mohamed Salah': 1.0, 'Bukayo Saka': 0.98
                },
                'Carries into Final Third per 90': {
                    'Jérémy Doku': 7.5, 'Jack Grealish': 7.0, 'Michael Olise': 6.8, 'Bukayo Saka': 6.5, 'Phil Foden': 6.3
                },
                'Progressive Carries per 90': {
                    'Jérémy Doku': 13.5, 'Jack Grealish': 13.0, 'Eberechi Eze': 12.8, 'Mohamed Salah': 12.5, 'Phil Foden': 12.0
                },
                'Pass Completion %': {
                    'Manuel Akanji': 94.0, 'Rodri': 93.5, 'John Stones': 93.0, 'William Saliba': 92.8, 'Nathan Aké': 92.5
                },
                'Shots on Target %': {
                    'Cole Palmer': 58.0, 'Erling Haaland': 55.0, 'Harry Kane': 52.5, 'Ollie Watkins': 50.0, 'Dominic Solanke': 48.0
                }
            },
            '2023': {
                'Goals per 90': {
                    'Erling Haaland': 0.94, 'Harry Kane': 0.88, 'Mohamed Salah': 0.63, 'Callum Wilson': 0.60, 'Marcus Rashford': 0.58
                },
                'xG per 90': {
                    'Erling Haaland': 0.87, 'Harry Kane': 0.67, 'Darwin Núñez': 0.64, 'Marcus Rashford': 0.54, 'Callum Wilson': 0.53
                },
                'Assists per 90': {
                    'Kevin De Bruyne': 0.51, 'Leandro Trossard': 0.46, 'Bukayo Saka': 0.38, 'Michael Olise': 0.38, 'Riyad Mahrez': 0.38
                },
                 'Progressive Passes per 90': {
                    'Rodri': 9.2, 'Lewis Dunk': 8.9, 'Luke Shaw': 8.5, 'Thiago Silva': 8.2, 'Rúben Neves': 8.0
                },
                'Dribbles per 90': {
                    'Adama Traoré': 4.1, 'Allan Saint-Maximin': 4.0, 'Eberechi Eze': 3.4, 'Solly March': 3.1, 'Gabriel Martinelli': 3.0
                },
                'Tackles per 90': {
                    'Tyler Adams': 3.6, 'João Palhinha': 3.5, 'Alex Iwobi': 3.2, 'Saïd Benrahma': 3.1, 'Casemiro': 3.0
                },
                'Interceptions per 90': {
                    'João Palhinha': 2.2, 'Ibrahima Konaté': 2.1, 'Tyler Adams': 2.0, 'Diogo Dalot': 1.9, 'Moises Caicedo': 1.8
                },
                'Aerials Won per 90': {
                    'Dan Burn': 4.7, 'James Tarkowski': 4.5, 'Harry Maguire': 4.4, 'Ollie Watkins': 4.2, 'Dominic Calvert-Lewin': 4.1
                },
                'Shot-Creating Actions (SCA) per 90': {
                    'Kevin De Bruyne': 6.0, 'Bruno Fernandes': 5.2, 'Bukayo Saka': 4.9, 'Jack Grealish': 4.8, 'Mohamed Salah': 4.7
                },
                'Goal-Creating Actions (GCA) per 90': {
                    'Kevin De Bruyne': 1.05, 'Bruno Fernandes': 0.98, 'Bukayo Saka': 0.95, 'Leandro Trossard': 0.92, 'Mohamed Salah': 0.90
                },
                'Carries into Final Third per 90': {
                    'Jack Grealish': 6.5, 'Solly March': 6.2, 'Bukayo Saka': 6.1, 'Gabriel Martinelli': 5.9, 'Phil Foden': 5.8
                },
                'Progressive Carries per 90': {
                    'Jack Grealish': 12.1, 'Mohamed Salah': 11.8, 'Eberechi Eze': 11.5, 'Allan Saint-Maximin': 11.2, 'Phil Foden': 11.0
                },
                'Pass Completion %': {
                    'Manuel Akanji': 93.3, 'John Stones': 93.1, 'Nathan Aké': 92.5, 'Rodri': 91.5, 'Lewis Dunk': 91.2
                },
                'Shots on Target %': {
                    'Erling Haaland': 55.4, 'Son Heung-min': 50.0, 'Harry Kane': 47.9, 'Kelechi Iheanacho': 46.2, 'Mohamed Salah': 46.0
                }
            },
            '2022': {
                'Goals per 90': {
                    'Erling Haaland': 0.88, 'Mohamed Salah': 0.77, 'Son Heung-min': 0.69, 'Cristiano Ronaldo': 0.63, 'Harry Kane': 0.62
                },
                'xG per 90': {
                    'Mohamed Salah': 0.72, 'Cristiano Ronaldo': 0.68, 'Diogo Jota': 0.65, 'Kevin De Bruyne': 0.58, 'Harry Kane': 0.57
                },
                'Assists per 90': {
                    'Paul Pogba': 0.76, 'Trent Alexander-Arnold': 0.44, 'Mason Mount': 0.43, 'Kevin De Bruyne': 0.41, 'Jarrod Bowen': 0.38
                },
                 'Progressive Passes per 90': {
                    'Rúben Neves': 8.8, 'Jack Grealish': 8.5, 'Trent Alexander-Arnold': 8.2, 'Rodri': 8.0, 'Jorginho': 7.9
                },
                'Dribbles per 90': {
                    'Adama Traoré': 4.5, 'Allan Saint-Maximin': 4.2, 'Riyad Mahrez': 3.8, 'Wilfried Zaha': 3.6, 'Jack Grealish': 3.5
                },
                'Tackles per 90': {
                    'João Palhinha': 3.8, 'Rodrigo Bentancur': 3.5, 'Moises Caicedo': 3.4, 'Declan Rice': 3.3, 'N’Golo Kanté': 3.2
                },
                'Interceptions per 90': {
                    'Rúben Dias': 2.5, 'Declan Rice': 2.4, 'Ethan Pinnock': 2.3, 'Ben White': 2.2, 'Conor Coady': 2.1
                },
                'Aerials Won per 90': {
                    'Dominic Calvert-Lewin': 5.1, 'Chris Wood': 4.9, 'James Tarkowski': 4.8, 'Harry Maguire': 4.5, 'Ivan Toney': 4.3
                },
                'Shot-Creating Actions (SCA) per 90': {
                    'Kevin De Bruyne': 6.2, 'Bruno Fernandes': 5.8, 'Jack Grealish': 5.5, 'Mohamed Salah': 5.4, 'Bukayo Saka': 5.1
                },
                'Goal-Creating Actions (GCA) per 90': {
                    'Kevin De Bruyne': 1.15, 'Bruno Fernandes': 1.08, 'Mohamed Salah': 1.02, 'Jack Grealish': 0.95, 'Leandro Trossard': 0.91
                },
                'Carries into Final Third per 90': {
                    'Jack Grealish': 7.2, 'Mohamed Salah': 6.9, 'Gabriel Martinelli': 6.5, 'Bukayo Saka': 6.3, 'Eberechi Eze': 6.0
                },
                'Progressive Carries per 90': {
                    'Jack Grealish': 12.8, 'Mohamed Salah': 12.5, 'Eberechi Eze': 12.1, 'Allan Saint-Maximin': 11.9, 'Phil Foden': 11.5
                },
                'Pass Completion %': {
                    'John Stones': 94.1, 'Rúben Dias': 93.8, 'Nathan Aké': 93.5, 'Rodri': 92.8, 'Joël Matip': 92.4
                },
                'Shots on Target %': {
                    'Son Heung-min': 52.3, 'Erling Haaland': 50.9, 'Ivan Toney': 49.5, 'Cristiano Ronaldo': 48.7, 'Diogo Jota': 48.0
                }
            },
        };
        const statTypes = [
            'Goals per 90',
            'xG per 90',
            'Assists per 90',
            'Progressive Passes per 90',
            'Dribbles per 90',
            'Tackles per 90',
            'Interceptions per 90',
            'Aerials Won per 90',
            'Shot-Creating Actions (SCA) per 90',
            'Goal-Creating Actions (GCA) per 90',
            'Carries into Final Third per 90',
            'Progressive Carries per 90',
            'Pass Completion %',
            'Shots on Target %'
        ];
        const baseLeague = 'Premier League';
        let adjustedValue = 0;
        let factorsChartInstance = null;
        let adjustmentChartInstance = null;
        let comparisonChartInstance = null;
        let chatHistory = [];
        let currentPlayerName = '';
        let currentStatType = '';
        let currentRawValue = 0;
        let currentAdjustedValue = 0;
        let currentRawStatYear = '';
        let currentPlYear = '';

        function calculateDifficultyScores(plYear, uefaWeight, compWeight) {
            const baseUefa = leagueData[baseLeague][plYear].uefaCoeff;
            const baseComp = leagueData[baseLeague][plYear].competitiveness;
            for (const league in leagueData) {
                 for (const year in leagueData[league]) {
                    const data = leagueData[league][year];
                    const normalizedUefa = data.uefaCoeff / baseUefa;
                    const normalizedComp = data.competitiveness / baseComp;
                    const lds = (normalizedUefa * uefaWeight) + (normalizedComp * compWeight);
                    data.normalizedUefa = normalizedUefa;
                    data.normalizedComp = normalizedComp;
                    data.adjustmentFactor = lds;
                }
            }
        }
        function populateLeagueSelector() {
            const selector = document.getElementById('league');
            selector.innerHTML = '';
            Object.keys(leagueData).filter(l => l !== baseLeague).forEach(league => {
                const option = document.createElement('option');
                option.value = league;
                option.textContent = league;
                selector.appendChild(option);
            });
        }
        function populateStatSelectors() {
            const statSelector = document.getElementById('statType');
            statTypes.forEach(stat => {
                const option = document.createElement('option');
                option.value = stat;
                option.textContent = stat;
                statSelector.appendChild(option);
            });
        }
        function renderCharts(plYear) {
            if (factorsChartInstance) {
                factorsChartInstance.destroy();
            }
            if (adjustmentChartInstance) {
                adjustmentChartInstance.destroy();
            }
            const leagues = Object.keys(leagueData);
            const factorChartCtx = document.getElementById('factorsChart').getContext('2d');
            factorsChartInstance = new Chart(factorChartCtx, {
                type: 'bar',
                data: {
                    labels: leagues,
                    datasets: [
                        {
                            label: 'Normalized UEFA Coefficient',
                            data: leagues.map(l => leagueData[l][plYear].normalizedUefa),
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Normalized Competitiveness',
                            data: leagues.map(l => leagueData[l][plYear].normalizedComp),
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: false },
                        tooltip: { mode: 'index', intersect: false },
                    },
                    scales: {
                        y: { beginAtZero: true, suggestedMax: 1.1, title: { display: true, text: 'Normalized Score (PL = 1.0)' } },
                        x: { grid: { display: false } }
                    },
                }
            });
            const adjustmentChartCtx = document.getElementById('adjustmentChart').getContext('2d');
            adjustmentChartInstance = new Chart(adjustmentChartCtx, {
                type: 'bar',
                data: {
                    labels: leagues.filter(l => l !== baseLeague),
                    datasets: [{
                        label: 'Adjustment Factor',
                        data: leagues.filter(l => l !== baseLeague).map(l => leagueData[l][plYear].adjustmentFactor),
                        backgroundColor: leagues.filter(l => l !== baseLeague).map(l => leagueData[l][plYear].color),
                        borderColor: leagues.filter(l => l !== baseLeague).map(l => leagueData[l][plYear].color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: { display: false },
                    },
                    scales: {
                        y: { beginAtZero: true, suggestedMax: 1.0, title: { display: true, text: 'Adjustment Factor' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
        function renderPlayerComparisonChart(playerName, statType, rawValue, adjustedValue, plYear) {
            if (comparisonChartInstance) {
                comparisonChartInstance.destroy();
            }
            const topPlayers = topPLPlayersData[plYear][statType];
            if (!topPlayers) {
                 const ctx = document.getElementById('comparisonChart').getContext('2d');
                 ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                 return;
            }
            const labels = [playerName, ...Object.keys(topPlayers)];
            const rawDataValues = [rawValue, ...Object.values(topPlayers)];
            const adjustedDataValues = [adjustedValue, 0, 0, 0, 0, 0];
            const comparisonChartCtx = document.getElementById('comparisonChart').getContext('2d');
            comparisonChartInstance = new Chart(comparisonChartCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Raw Stat',
                            data: rawDataValues,
                            backgroundColor: 'rgba(252, 211, 77, 0.8)',
                            borderColor: 'rgba(252, 211, 77, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Adjusted Stat',
                            data: adjustedDataValues,
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: true },
                        tooltip: {
                             callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.x.toFixed(2);
                                    return label;
                                }
                             }
                        },
                        title: { display: false },
                    },
                    scales: {
                        x: { beginAtZero: true, title: { display: true, text: statType } },
                        y: { grid: { display: false } }
                    },
                }
            });
        }
        function performCalculation() {
            const selectedLeague = document.getElementById('league').value;
            const rawValue = parseFloat(document.getElementById('statValue').value);
            const playerName = document.getElementById('playerName').value;
            const statType = document.getElementById('statType').value;
            const plYear = document.getElementById('plYear').value;
            const rawStatYear = document.getElementById('rawStatYear').value;
            
            const uefaWeightSlider = document.getElementById('uefaWeight');
            const compWeightSlider = document.getElementById('compWeight');
            
            const tacklesValue = parseFloat(document.getElementById('tacklesValue').value);
            const dribblesValue = parseFloat(document.getElementById('dribblesValue').value);
            const progPassesValue = parseFloat(document.getElementById('progPassesValue').value);
            
            if (isNaN(rawValue) || !playerName || !statType || isNaN(tacklesValue) || isNaN(dribblesValue) || isNaN(progPassesValue)) {
                document.getElementById('adjustedValue').textContent = '-';
                document.getElementById('equivalentText').textContent = 'Please fill in all fields.';
                document.getElementById('analysisText').textContent = "Please fill in all fields to generate a report.";
                return;
            }
            
            const uefaWeight = uefaWeightSlider.value / 100;
            const compWeight = compWeightSlider.value / 100;
            
            const lm = (leagueData[selectedLeague][rawStatYear].uefaCoeff / leagueData[baseLeague][plYear].uefaCoeff) * uefaWeight +
                       (leagueData[selectedLeague][rawStatYear].competitiveness / leagueData[baseLeague][plYear].competitiveness) * compWeight;

            const plBenchmark = {
                'Progressive Passes per 90': 9.0,
                'Dribbles per 90': 3.5,
                'Tackles per 90': 3.0
            };
            
            const progPassesRatio = progPassesValue / plBenchmark['Progressive Passes per 90'];
            const dribblesRatio = dribblesValue / plBenchmark['Dribbles per 90'];
            const tacklesRatio = tacklesValue / plBenchmark['Tackles per 90'];
            
            const pm = Math.pow((progPassesRatio + dribblesRatio + tacklesRatio) / 3, 1.15);
            
            adjustedValue = rawValue * lm * pm;
            
            document.getElementById('adjustedValue').textContent = adjustedValue.toFixed(2);
            document.getElementById('lmValue').textContent = lm.toFixed(2);
            document.getElementById('pmValue').textContent = pm.toFixed(2);
            
            document.getElementById('equivalentText').textContent = `is the Premier League equivalent for ${statType}.`;
            
            currentPlayerName = playerName;
            currentStatType = statType;
            currentRawValue = rawValue;
            currentAdjustedValue = adjustedValue;
            currentRawStatYear = rawStatYear;
            currentPlYear = plYear;
            
            generateScoutingReport(playerName, statType, rawValue, adjustedValue, rawStatYear, plYear, lm, pm);
            renderPlayerComparisonChart(playerName, statType, rawValue, adjustedValue, plYear);
        }
        function renderChatHistory() {
            const chatContainer = document.getElementById('chatHistory');
            chatContainer.innerHTML = '';
            chatHistory.forEach(turn => {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('flex', 'flex-col', 'space-y-1');
                const roleText = document.createElement('p');
                roleText.classList.add('font-semibold', turn.role === 'user' ? 'text-blue-600' : 'text-slate-800');
                roleText.textContent = turn.role === 'user' ? 'You' : 'Scout AI';
                const contentText = document.createElement('p');
                contentText.classList.add('text-sm', 'p-2', 'rounded-lg');
                contentText.classList.add(turn.role === 'user' ? 'bg-blue-100' : 'bg-slate-100');
                contentText.textContent = turn.parts[0].text;
                messageContainer.appendChild(roleText);
                messageContainer.appendChild(contentText);
                chatContainer.appendChild(messageContainer);
            });
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        async function handleFollowUp() {
            const followUpInput = document.getElementById('followUpInput');
            const followUpBtn = document.getElementById('followUpBtn');
            const userQuestion = followUpInput.value.trim();
            if (userQuestion === '') return;
            followUpInput.value = '';
            followUpBtn.disabled = true;
            const userMessage = { role: 'user', parts: [{ text: userQuestion }] };
            chatHistory.push(userMessage);
            renderChatHistory();
            const loadingMessage = { role: 'model', parts: [{ text: 'Thinking...' }] };
            chatHistory.push(loadingMessage);
            renderChatHistory();
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${geminiApiKey}`;
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: chatHistory,
                        tools: [{ "google_search": {} }],
                    })
                });
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    chatHistory.pop();
                    chatHistory.push({ role: 'model', parts: [{ text: text }] });
                    renderChatHistory();
                } else {
                    chatHistory.pop();
                    chatHistory.push({ role: 'model', parts: [{ text: "Unable to generate a report. Please try again." }] });
                    renderChatHistory();
                }
            } catch (error) {
                chatHistory.pop();
                chatHistory.push({ role: 'model', parts: [{ text: "An error occurred while connecting to the API." }] });
                renderChatHistory();
            } finally {
                followUpBtn.disabled = false;
            }
        }
        
        const calculateBtn = document.getElementById('calculateBtn');
        const followUpBtn = document.getElementById('followUpBtn');
        const followUpInput = document.getElementById('followUpInput');
        const plYearSelector = document.getElementById('plYear');
        const uefaWeightSlider = document.getElementById('uefaWeight');
        const compWeightSlider = document.getElementById('compWeight');
        const uefaWeightValue = document.getElementById('uefaWeightValue');
        const compWeightValue = document.getElementById('compWeightValue');
        const lmValue = document.getElementById('lmValue');
        const pmValue = document.getElementById('pmValue');

        if (calculateBtn) {
            calculateBtn.addEventListener('click', performCalculation);
        }

        if (followUpBtn) {
            followUpBtn.addEventListener('click', handleFollowUp);
        }
        
        if (followUpInput) {
            followUpInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleFollowUp();
                }
            });
        }
        
        if (uefaWeightSlider) {
            uefaWeightSlider.addEventListener('input', () => syncWeights('uefa'));
        }

        if (compWeightSlider) {
            compWeightSlider.addEventListener('input', () => syncWeights('comp'));
        }
        
        if (plYearSelector) {
            plYearSelector.addEventListener('change', (event) => {
                const newYear = event.target.value;
                const uefaWeight = uefaWeightSlider.value / 100;
                const compWeight = compWeightSlider.value / 100;
                calculateDifficultyScores(newYear, uefaWeight, compWeight);
                renderCharts(newYear);
            });
        }
        
        function updateWeights() {
            const uefaWeight = uefaWeightSlider.value / 100;
            const compWeight = compWeightSlider.value / 100;
            uefaWeightValue.textContent = `${uefaWeightSlider.value}%`;
            compWeightValue.textContent = `${compWeightSlider.value}%`;
            calculateDifficultyScores(document.getElementById('plYear').value, uefaWeight, compWeight);
            renderCharts(document.getElementById('plYear').value);
        }

        function syncWeights(sliderChanged) {
            let otherSlider;
            if (sliderChanged === 'uefa') {
                otherSlider = compWeightSlider;
                otherSlider.value = 100 - uefaWeightSlider.value;
            } else {
                otherSlider = uefaWeightSlider;
                otherSlider.value = 100 - compWeightSlider.value;
            }
            updateWeights();
        }

        calculateDifficultyScores(document.getElementById('plYear').value, 0.7, 0.3);
        populateLeagueSelector();
        populateStatSelectors();
        renderCharts(document.getElementById('plYear').value);

        const geminiApiKey = "";
        async function generateScoutingReport(playerName, statType, rawValue, adjustedValue, rawStatYear, plYear, lm, pm) {
            document.getElementById('followUpSection').classList.add('hidden');
            document.getElementById('analysisText').textContent = "Generating report...";
            chatHistory = [];
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${geminiApiKey}`;
            const userPrompt = `Act as a professional football scout. Write a concise, one-paragraph scouting report on a player named ${playerName}. In ${rawStatYear}, they had a raw stat of ${rawValue} ${statType}. Our model calculates a League Multiplier (LM) of ${lm.toFixed(2)} and a Playstyle Multiplier (PM) of ${pm.toFixed(2)}. Their adjusted stat is ${adjustedValue.toFixed(2)} ${statType} for the Premier League in ${plYear}. Compare their raw stat to their adjusted stat and give context on what this suggests about their on-field profile. Do not mention any specific league or team names. Do not use asterisks or bolding in the report.`;
            const payload = {
                contents: [{ role: 'user', parts: [{ text: userPrompt }] }],
                tools: [{ "google_search": {} }],
            };
            try {
                let response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                let result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    chatHistory.push({ role: 'user', parts: [{ text: userPrompt }] });
                    chatHistory.push({ role: 'model', parts: [{ text: text }] });
                    document.getElementById('reportContainer').innerHTML = `<p id="analysisText" class="text-slate-800">${text}</p>`;
                    document.getElementById('followUpSection').classList.remove('hidden');
                    document.getElementById('chatHistory').innerHTML = '';
                } else {
                    document.getElementById('analysisText').textContent = "Unable to generate a report. Please try again.";
                }
            } catch (error) {
                document.getElementById('analysisText').textContent = "An error occurred while connecting to the API.";
            }
        }
    });
</script>
</body>
</html>
